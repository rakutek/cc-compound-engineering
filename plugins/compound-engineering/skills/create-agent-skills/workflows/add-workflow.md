# Workflow: 既存のスキルにワークフローを追加する

<required_reading>
**今すぐこれらのリファレンスファイルを読んでください:**
1. references/recommended-structure.md
2. references/workflows-and-validation.md
</required_reading>

<process>
## ステップ1: スキルを選択する

**AskUserQuestionを使用しないでください** - 多くのスキルがあるかもしれません。

```bash
ls ~/.claude/skills/
```

番号付きリストを表示し、「どのスキルに新しいワークフローが必要ですか？」と尋ねます。

## ステップ2: 現在の構造を分析する

スキルを読みます:
```bash
cat ~/.claude/skills/{skill-name}/SKILL.md
ls ~/.claude/skills/{skill-name}/workflows/ 2>/dev/null
```

以下を判断します:
- **シンプルなスキルか？** → 最初にルーターパターンにアップグレードする必要があるかもしれません
- **すでにworkflows/があるか？** → 良好、直接追加できます
- **どのようなワークフローが存在するか？** → 重複を避ける

現在の構造をユーザーに報告します。

## ステップ3: ワークフロー要件を収集する

AskUserQuestionまたは直接質問を使用して尋ねます:
- このワークフローは何をすべきですか？
- 既存のワークフローと比較して、いつ使用しますか？
- どのようなリファレンスが必要ですか？

## ステップ4: ルーターパターンにアップグレードする（必要な場合）

**スキルが現在シンプルな場合（workflows/がない）:**

「このスキルは最初にルーターパターンにアップグレードする必要があります。再構造しますか？」と尋ねます。

「はい」の場合:
1. workflows/ディレクトリを作成
2. 既存のprocessコンテンツをworkflows/main.mdに移動
3. SKILL.mdをインテーク + ルーティングを持つルーターとして書き直す
4. 続行する前に構造が機能することを確認

## ステップ5: ワークフローファイルを作成する

`workflows/{workflow-name}.md`を作成します:

```markdown
# Workflow: {ワークフロー名}

<required_reading>
**今すぐこれらのリファレンスファイルを読んでください:**
1. references/{関連ファイル}.md
</required_reading>

<process>
## ステップ1: {最初のステップ}
[何をするか]

## ステップ2: {二番目のステップ}
[何をするか]

## ステップ3: {三番目のステップ}
[何をするか]
</process>

<success_criteria>
このワークフローは以下が完了したときに完了です:
- [ ] 基準 1
- [ ] 基準 2
- [ ] 基準 3
</success_criteria>
```

## ステップ6: SKILL.mdを更新する

新しいワークフローを以下に追加します:

1. **インテーク質問** - 新しいオプションを追加
2. **ルーティングテーブル** - オプションをワークフローファイルにマッピング
3. **ワークフローインデックス** - リストに追加

## ステップ7: リファレンスを作成する（必要な場合）

ワークフローが存在しないドメイン知識を必要とする場合:
1. `references/{reference-name}.md`を作成
2. SKILL.mdのreference_indexに追加
3. ワークフローのrequired_readingで参照

## ステップ8: テストする

スキルを呼び出します:
- インテークに新しいオプションが表示されますか？
- それを選択すると正しいワークフローにルーティングされますか？
- ワークフローが正しいリファレンスを読み込みますか？
- ワークフローが正しく実行されますか？

結果をユーザーに報告します。
</process>

<success_criteria>
ワークフローの追加は以下が完了したときに完了です:
- [ ] スキルがルーターパターンにアップグレードされた（必要な場合）
- [ ] required_reading、process、success_criteriaを持つワークフローファイルが作成された
- [ ] SKILL.mdのインテークが新しいオプションで更新された
- [ ] SKILL.mdのルーティングが更新された
- [ ] SKILL.mdのworkflows_indexが更新された
- [ ] 必要なリファレンスが作成された
- [ ] テスト済みで機能している
</success_criteria>
